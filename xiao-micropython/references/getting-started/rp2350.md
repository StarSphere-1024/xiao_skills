# XIAO RP2350 MicroPython Getting Started

## Overview

The XIAO RP2350 is a dual-core board with programmable I/O (PIO) and enhanced peripherals.

## Board Specifications

- **MCU**: Raspberry Pi RP2350 (dual-core Arm Cortex-M33)
- **Flash**: 4MB or 8MB
- **RAM**: 520KB SRAM
- **GPIO**: 11 pins
- **I2C**: D4 (SDA), D5 (SCL)
- **SPI**: D8 (SCK), D9 (MISO), D10 (MOSI)
- **UART**: D6 (TX), D7 (RX)
- **ADC**: A0-A3 (D0-D3)
- **PWM**: All GPIO pins
- **PIO**: 2 state machines

## Firmware Download

```bash
# Download from:
# https://micropython.org/download/RPI_PICO2/
```

## Flashing Firmware

### Using rp2040-flash-tool

```bash
# Hold BOOTSEL button while connecting USB
# Device appears as USB mass storage (RPI-RP2)

# Copy firmware.bin to the device
# On Windows: Drag and drop
# On Linux: cp firmware.bin /media/RPI-RP2/

# Or use command line:
cp firmware.bin /media/RPI-RP2/
```

### Using Thonny IDE

1. Download firmware from micropython.org
2. Hold BOOTSEL while connecting USB
3. Open Thonny IDE
4. Tools > Options > Interpreter
5. Select "MicroPython (Raspberry Pi Pico 2)"
6. Click "Install or update MicroPython"

## First Connection

### Using Thonny IDE

1. Open Thonny
2. Click "Stop/Restart"
3. Select "MicroPython (Raspberry Pi Pico 2)" interpreter
4. Select the XIAO RP2350 port
5. You should see the REPL prompt `>>>`

### Using mpremote

```bash
# Install mpremote
pip install mpremote

# Connect
mpremote connect auto

# Run REPL
mpremote repl
```

## First Script

```python
# test.py - Blink the built-in LED

from machine import Pin
import time

# LED is on D10
led = Pin(10, Pin.OUT)

print("Hello from XIAO RP2350!")

while True:
    led.toggle()
    print("LED toggle")
    time.sleep(1)
```

## Pin Mapping

| Pin Name | GPIO | Functions |
|----------|------|-----------|
| D0 | GPIO1 | ADC0, UART |
| D1 | GPIO2 | ADC1, UART |
| D2 | GPIO3 | ADC2, I2C |
| D3 | GPIO4 | ADC3, I2C |
| D4 | GPIO5 | I2C (SDA) |
| D5 | GPIO6 | I2C (SCL) |
| D6 | GPIO17 | UART TX |
| D7 | GPIO16 | UART RX |
| D8 | GPIO2 | SPI SCK |
| D9 | GPIO3 | SPI MISO |
| D10 | GPIO4 | SPI MOSI, LED |

## PIO (Programmable I/O)

RP2350 has 2 PIO blocks with 4 state machines each:

```python
import rp2
from machine import Pin
import time

# Simple PIO program to blink LED
@rp2.asm_pio(set=rp2.PIO.OUT_LOW)
def blink():
    mov(x, osr)        # Load X with OSR
    set(pins, 1)       # Set pin high
    mov(y, x)          # Copy X to Y
    label("delay_high")
    nop() [31]
    jmp(y_dec, "delay_high")

    set(pins, 0)       # Set pin low
    mov(y, x)          # Copy X to Y
    label("delay_low")
    nop() [31]
    jmp(y_dec, "delay_low")

    jmp(x_dec, "start")  # Loop forever

# Use PIO on pin 10
sm = rp2.StateMachine(0, blink, freq=2000, set_base=Pin(10))
sm.put(30)  # Loop count
sm.exec("pull()")
sm.exec("mov(osr, x)")
sm.active(1)
```

## I2C Scanner

```python
from machine import Pin, I2C

i2c = I2C(0, scl=Pin(5), sda=Pin(4), freq=100000)
devices = i2c.scan()

print(f'I2C devices found: {len(devices)}')
for d in devices:
    print(f'  {hex(d)}')
```

## PWM

```python
from machine import Pin, PWM
import time

pwm = PWM(Pin(10))
pwm.freq(1000)

# Fade LED
for duty in range(0, 65536, 256):
    pwm.duty_u16(duty)
    time.sleep(0.01)
```

## ADC

```python
from machine import ADC
import time

adc = ADC(Pin(0))  # A0

while True:
    value = adc.read_u16()  # 0-65535
    voltage = value * 3.3 / 65535
    print(f"ADC: {value}, Voltage: {voltage:.2f}V")
    time.sleep(0.5)
```

## Boot Scripts

### boot.py

```python
# boot.py - Runs on every boot

import machine
import time

# Disable LED on boot
led = machine.Pin(10, machine.Pin.OUT)
led.off()

print('boot.py: XIAO RP2350 ready')
```

### main.py

```python
# main.py - Runs after boot.py

import time

print('main.py: Starting...')

while True:
    print('Running...')
    time.sleep(5)
```

## Uploading Scripts

### Using Thonny

1. Write your script
2. File > Save As
3. Select "MicroPython device"
4. Name it `main.py` for auto-run

### Using mpremote

```bash
# Upload file
mpremote fs cp script.py :main.py

# Reset device
mpremote reset
```

## Sleep Modes

```python
import machine
import time

# Light sleep (maintains RAM but stops CPU)
def light_sleep_ms(ms):
    machine.lightsleep(ms)

# Deep sleep (reboots on wake)
def deep_sleep_ms(ms):
    machine.deepsleep(ms)

# Use RTC memory to persist data
rtc = machine.RTC()
rtc.memory('saved data')

# Example: Sleep for 10 seconds
print("Sleeping...")
machine.deepsleep(10000)
print("Woke up!")  # Only executes on deep sleep wake
```

## Troubleshooting

### Device not found

1. Check USB cable (data + power, not power-only)
2. Try different USB port
3. No driver needed for RP2350

### Flash fails

1. Hold BOOTSEL while connecting USB
2. Device should appear as USB drive
3. Try shorter file name for firmware

### Boot script errors

1. Connect with Thonny
2. Stop any running script
3. Delete boot.py or main.py if needed

## Next Steps

- Learn PIO: `references/api/rp2040-pio.md`
- Sleep modes: `references/api/rp-sleep.md`
- Project examples: `references/examples/`
