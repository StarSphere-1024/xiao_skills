# MicroPython on XIAO RP2040

## Overview

Getting started with MicroPython on SeeedStudio XIAO RP2040.

## Installation

### Download Firmware

1. Download MicroPython for RP2040: https://micropython.org/download/XIAO_RP2040/
2. Download `MICROPYTHON-*.uf2`

### Flash Firmware

1. Hold BOOTSEL button while connecting USB
2. Drag and drop `.uf2` file to RPI-RP2 drive
3. Board will restart automatically

### Verify Installation

```
Serial: 115200 baud
>>> print("Hello XIAO!")
Hello XIAO!
>>> import machine
>>> machine.freq()
125000000
```

## Thonny IDE Setup

### Install Thonny

1. Download: https://thonny.org/
2. Install and launch
3. Tools > Options > Interpreter > MicroPython (RP2040)

### Run Scripts

1. Connect to XIAO RP2040
2. Write script in editor
3. Press F5 or click Run

## Pin Mapping

| Name | GPIO | Notes |
|------|------|-------|
| D0 | GPIO0 | I2C SDA |
| D1 | GPIO1 | I2C SCL |
| D2 | GPIO2 | UART0 TX |
| D3 | GPIO3 | UART0 RX |
| D4 | GPIO4 | SPI CS |
| D5 | GPIO5 | SPI MOSI |
| D6 | GPIO6 | SPI MISO |
| D7 | GPIO7 | SPI SCK |
| D8 | GPIO8 | User LED (built-in) |
| D9 | GPIO9 | - |
| D10 | GPIO10 | - |

## Basic Examples

### Blink LED

```python
import machine
import time

led = machine.Pin(25, machine.Pin.OUT)  # Built-in LED

while True:
    led.on()
    time.sleep(0.5)
    led.off()
    time.sleep(0.5)
```

### Read Analog

```python
import machine
from machine import Pin, ADC
import time

adc = ADC(0)  # ADC0 on GPIO26

while True:
    value = adc.read_u16()
    voltage = value * 3.3 / 65535
    print(f"ADC: {value}, Voltage: {voltage:.2f}V")
    time.sleep(0.5)
```

### I2C Scanner

```python
from machine import Pin, I2C
import time

i2c = I2C(0, sda=Pin(0), scl=Pin(1))

print("Scanning I2C...")
while True:
    devices = i2c.scan()
    if devices:
        print(f"Found {len(devices)} device(s)")
        for dev in devices:
            print(f"  I2C: {hex(dev)}")
    else:
        print("No devices")
    time.sleep(2)
```

### SPI Temperature

```python
from machine import Pin, SPI
import time

spi = SPI(0, baudrate=1000000, sck=Pin(7), mosi=Pin(5), miso=Pin(6))
cs = Pin(4, Pin.OUT)

def read_temp():
    cs.low()
    spi.read(1, 0x00)  # Send command
    data = spi.read(2)
    cs.high()
    temp = (data[0] << 8 | data[1]) >> 3
    return temp * 0.0625

while True:
    print(f"Temperature: {read_temp():.2f}C")
    time.sleep(1)
```

### UART Communication

```python
from machine import Pin, UART
import time

uart = UART(0, baudrate=9600, tx=Pin(2), rx=Pin(3))

def send_data(data):
    uart.write(data + '\n')

def read_data():
    if uart.any():
        return uart.readline()
    return None

# Send
send_data("Hello XIAO!")

# Read loop
while True:
    data = read_data()
    if data:
        print(f"Received: {data}")
    time.sleep(0.1)
```

## PWM (Multiple Outputs)

```python
from machine import Pin, PWM
import time

pwm0 = PWM(Pin(0))
pwm1 = PWM(Pin(1))
pwm0.freq(1000)
pwm1.freq(1000)

# Fade LEDs
while True:
    for duty in range(0, 65536, 100):
        pwm0.duty_u16(duty)
        pwm1.duty_u16(65535 - duty)
        time.sleep(0.01)
```

## PIO (Programmable I/O)

### NeoPixel PIO

```python
import rp2
from machine import Pin
import time

@rp2.asm_pio(sideset_init=rp2.PIO.OUT_LOW, out_shiftdir=rp2.PIO.SHIFT_LEFT)
def ws2812():
    T = 2
    wrap_target()
    label("bitloop")
    out(x, 1)       .side(0)    [T - 1]
    mov(y, ~x)      .side(1)    [T - 1]
    jmp(not_y, "bitzero") .side(0)
    jmp("bitloop")  .side(1)    [T - 1]
    label("bitzero")
    nop()           .side(0)    [T - 1]
    wrap()

sm = rp2.StateMachine(0, ws2812, freq=8000000, sideset_pin=Pin(6))
sm.active(1)

def set_pixel(rgb):
    sm.put(rgb << 8, 8)

# Red pixel
set_pixel(0xFF0000)
time.sleep(1)
```

## SD Card

```python
import machine
import os
from machine import Pin, SPI
import sdcard

spi = SPI(0, sck=Pin(7), mosi=Pin(5), miso=Pin(6))
sd = sdcard.SDCard(spi, Pin(4))
os.mount(sd, '/sd')

# List files
print(os.listdir('/sd'))

# Write file
with open('/sd/test.txt', 'w') as f:
    f.write('Hello from XIAO RP2040!')

# Read file
with open('/sd/test.txt', 'r') as f:
    print(f.read())
```

## Network (WIZnet W5500)

```python
import network
import socket
import time

# Initialize W5500
nic = network.WIZNET5K(spi=SPI(0), cs=Pin(4))
nic.active(True)
nic.ifconfig(('192.168.1.100', '255.255.255.0', '192.168.1.1', '8.8.8.8'))

# HTTP GET
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('httpbin.org', 80))
s.send(b'GET /get HTTP/1.0\r\n\r\n')
response = s.recv(1024)
print(response)
s.close()
```

## Dual Core

```python
import _thread
import machine
import time

def core0_task():
    led = machine.Pin(25, machine.Pin.OUT)
    while True:
        led.on()
        time.sleep(0.5)
        led.off()
        time.sleep(0.5)

def core1_task():
    while True:
        print("Core 1 running")
        time.sleep(1)

_thread.start_new_thread(core1_task, ())

while True:
    print("Core 0 running")
    time.sleep(1)
```

## Watchdog Timer

```python
import machine
import time

wdt = machine.WDT(timeout=5000)  # 5 seconds

def feed_wdt():
    wdt.feed()

while True:
    print("Feeding watchdog")
    feed_wdt()
    time.sleep(1)
```

## Deep Sleep

```python
import machine
import time

# Sleep for 10 seconds
machine.deepsleep(10000)

# Will reset on wake
print("This won't be reached")
```

## RTC

```python
import machine
import time

rtc = machine.RTC()
rtc.datetime((2024, 1, 15, 1, 12, 30, 0, 0))

while True:
    year, month, day, wday, hour, minute, second, ms = rtc.datetime()
    print(f"{hour:02d}:{minute:02d}:{second:02d}")
    time.sleep(1)
```

## Troubleshooting

### Can't upload

1. Hold BOOTSEL while connecting USB
2. Check RPI-RP2 drive appears
3. Try different USB cable

### Scripts don't run

1. Save as `main.py` for auto-run
2. Check for syntax errors
3. Verify correct interpreter in Thonny

### I2C fails

1. Check pull-up resistors
2. Verify pin mapping (D0/D1)
3. Try lower frequency

### SPI errors

1. Verify all pins connected
2. Check CS pin configuration
3. Confirm baudrate not too high

### Boot loop

1. Check `main.py` for errors
2. Remove `main.py` to stop auto-run
3. Use safe mode: hold BOOTSEL

## Performance Tips

1. Use @micropython.native for speed
2. Use @micropython.viper for critical code
3. Pre-allocate buffers
4. Minimize object creation in loops
5. Use const for constants
