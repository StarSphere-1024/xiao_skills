# XIAO nRF52840 Arduino Getting Started

## Board Manager Setup

1. Open Arduino IDE 2.x
2. Add to "Additional Boards Manager URLs":
   ```
   https://raw.githubusercontent.com/adafruit/arduino-index-nrf52/package_adafruit_index.json
   ```
3. Install "Adafruit nRF52 by Adafruit"
4. Select: **Tools > Board > Adafruit nRF52840 Boards > Seeed XIAO nRF52840**

## Board Settings

| Setting | Options | Recommended |
|---------|----------|-------------|
| SoftDevice | S140 v7.3.0, S132 v7.3.0 | S140 for BLE |
| Debug Level | None, Minimal | None (release) |
| LFO (RC Oscillator) | Enabled, Disabled | Enabled (lower power) |

## Pin Mapping

| Pin | nRF Pin | Arduino | Function | Notes |
|-----|---------|---------|----------|-------|
| D0 | P0.02 | A0 | ADC/Digital | - |
| D1 | P0.03 | A1 | ADC/Digital | - |
| D2 | P0.04 | A4 | ADC/Digital | - |
| D3 | P0.05 | A5 | ADC/Digital | - |
| D4 | P1.10 | D19 | I2C SDA (Sense only) | - |
| D5 | P1.11 | D6 | I2C SCL (Sense only) | - |
| D6 | P0.26 | D11 | Digital | - |
| D7 | P1.10 | D16 | Digital (Sense only) | - |
| D8 | P0.06 | D12 | Digital, SPI MISO | - |
| D9 | P0.07 | D17 | Digital, SPI SCK (Sense) | - |
| D10 | P1.15 | D10 | Digital, SPI CS | - |
| A0 | P0.29 | A3 | ADC/Digital | - |
| A1 | P0.31 | A2 | ADC/Digital | - |
| A2 | P0.28 | A2 | ADC/Digital | - |
| A3 | P0.30 | D13 | ADC/Digital | - |

## I2C (Sense model only)

```cpp
#include <Wire.h>

void setup() {
    Wire.begin();  // D4 (SDA), D5 (SCL)
    Wire.setClock(100000);
}

void loop() {}
```

## SPI

```cpp
#include <SPI.h>

void setup() {
    SPI.begin();  // D8 (MISO), D9 (SCK), D10 (CS)
}

void loop() {
    byte data = SPI.transfer(0x00);
}
```

## First BLE Sketch

```cpp
#include <bluefruit.h>

#define DEVICE_NAME "XIAO_nRF52"

void setup() {
    Serial.begin(115200);
    Bluefruit.begin();

    Bluefruit.setName(DEVICE_NAME);
    Bluefruit.Periph.setConnectCallback(connect_callback);
    Bluefruit.Periph.setDisconnectCallback(disconnect_callback);

    // Start advertising
    Bluefruit.Advertising.addFlags(BLE_GAP_ADV_FLAGS_LE_ONLY_GENERAL_DISC_MODE);
    Bluefruit.Advertising.start();

    Serial.println("BLE advertising started");
}

void loop() {
    // BLE tasks handled automatically
}

void connect_callback(uint16_t conn_handle) {
    Serial.println("Connected!");
}

void disconnect_callback(uint16_t conn_handle, uint8_t reason) {
    Serial.println("Disconnected");
}
```

## Deep Sleep

```cpp
#include <Adafruit_LittleFS.h>
#include <Adafruit_SleepyDog.h>

void setup() {
    Serial.begin(115200);
}

void loop() {
    // Watchdog sleep
    int sleepMS = Watchdog.sleep(5000);
    Serial.printf("Slept for %d ms\n", sleepMS);

    // Or system off (reset to wake)
    // NRF_POWER->SYSTEMOFF = 1;
}
```

## Bootloader Entry

1. **Double-click** RESET button
2. RPI-RP2 drive appears
3. Drag and drop `.uf2` file
4. Board reboots automatically

## UF2 Firmware

Download: https://www.adafruit.com/package/uf2-samd51-nrf52840feather-uf2/default/

## Troubleshooting

### Bootloader not detected

1. Double-click RESET button rapidly
2. Install Adafruit nRF52 drivers
3. Try different USB port

### BLE not advertising

1. Check Bluefruit.begin() is called
2. Check advertising interval
3. Verify another device can scan for it

### High current consumption

1. Enable DCDC converter: `NRF_POWER->DCDCEN = 1`
2. Use System Off for battery devices
3. Reduce advertising interval
