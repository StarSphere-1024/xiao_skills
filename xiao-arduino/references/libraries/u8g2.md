# U8g2 Graphics Library

## Overview

**U8g2** is a universal graphics library for embedded devices. It supports a wide range of display controllers including SSD1306, SH1106, SH1107, SSD1315, and many more. The library provides both I2C and SPI communication interfaces.

### Features

- Supports 200+ display controllers
- Full buffer, page buffer, and partial buffer modes
- Built-in font library (100+ fonts)
- UTF-8 support
- Low memory footprint

## Installation

In Arduino IDE, navigate to `Sketch > Include Library > Manage Libraries...`, search for **u8g2** and install it.

## I2C OLED Displays

### SH1107 128x128 (Grove OLED 1.12")

**Hardware Connection:**

| OLED Pin | XIAO Pin |
|----------|----------|
| GND      | GND      |
| VCC      | 5V       |
| SDA      | SDA (D4) |
| SCL      | SCL (D5) |

**Code Example:**

```cpp
#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

// Software I2C: specify SCL and SDA pins
U8G2_SH1107_SEEED_128X128_1_SW_I2C u8g2(U8G2_R0, /* clock=*/ 5, /* data=*/ 4, /* reset=*/ U8X8_PIN_NONE);

void setup(void) {
    u8g2.begin();
}

void loop(void) {
    u8g2.firstPage();
    do {
        u8g2.setFont(u8g2_font_luBIS08_tf);
        u8g2.drawStr(0, 24, "Hello Seeed!");
    } while (u8g2.nextPage());
}
```

### SSD1306/SSD1315 128x64

**Hardware Connection:**

| OLED Pin | XIAO Pin |
|----------|----------|
| GND      | GND      |
| VCC      | 5V       |
| SDA      | SDA      |
| SCL      | SCL      |

**Code Example (Full Buffer Mode):**

```cpp
#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

U8G2_SSD1306_128X64_NONAME_F_SW_I2C u8g2(U8G2_R0, /* clock=*/ SCL, /* data=*/ SDA, /* reset=*/ U8X8_PIN_NONE);

void setup(void) {
    u8g2.begin();
}

void loop(void) {
    u8g2.clearBuffer();                   // Clear the internal memory
    u8g2.setFont(u8g2_font_ncenB08_tr);   // Choose a suitable font
    u8g2.drawStr(0, 10, "Hello World!");  // Write something to the internal memory
    u8g2.drawStr(0, 30, "Line 2!");
    u8g2.drawStr(0, 50, "Line 3!");
    u8g2.sendBuffer();                    // Transfer internal memory to the display
    delay(1000);
}
```

## SPI OLED Displays

### SH1107 128x128 via SPI

**Hardware Connection:**

| OLED Pin | XIAO Pin |
|----------|----------|
| GND      | GND      |
| 5V       | 5V       |
| SCL      | SCK      |
| SI       | MOSI     |
| RES      | D3       |
| D/C      | D4       |
| CS       | D5       |

> **Note:** Grove OLED 1.12" supports both I2C and SPI. Default is I2C mode. Change to SPI mode before using this configuration.

**Code Example:**

```cpp
#include <Arduino.h>
#include <U8g2lib.h>
#include <SPI.h>
#include <Wire.h>

U8G2_SH1107_128X128_1_4W_HW_SPI u8g2(U8G2_R3, /* cs=*/ 5, /* dc=*/ 4, /* reset=*/ 3);

void setup(void) {
    u8g2.begin();
}

void loop(void) {
    u8g2.firstPage();
    do {
        u8g2.setFont(u8g2_font_luBIS08_tf);
        u8g2.drawStr(0, 24, "Hello Seeed!");
    } while ( u8g2.nextPage() );
}
```

## U8g2 Display Modes

### Full Buffer Mode (`_F_` suffix)

Uses a full frame buffer in RAM. Fastest rendering but requires more memory.

```cpp
U8G2_SSD1306_128X64_NONAME_F_HW_I2C u8g2(U8G2_R0, /* reset=*/ U8X8_PIN_NONE);

void loop() {
    u8g2.clearBuffer();
    u8g2.setFont(u8g2_font_ncenB08_tr);
    u8g2.drawStr(0, 10, "Full Buffer");
    u8g2.sendBuffer();
    delay(1000);
}
```

### Page Buffer Mode (`_1_` or `_2_` suffix)

Renders display in pages. Lower memory usage.

```cpp
U8G2_SSD1306_128X64_NONAME_1_HW_I2C u8g2(U8G2_R0, /* reset=*/ U8X8_PIN_NONE);

void loop() {
    u8g2.firstPage();
    do {
        u8g2.setFont(u8g2_font_ncenB08_tr);
        u8g2.drawStr(0, 10, "Page Buffer");
    } while (u8g2.nextPage());
}
```

## Graphics Functions

### Text

```cpp
// Set font
u8g2.setFont(u8g2_font_ncenB08_tr);  // Use u8g2_font_ prefix + font name

// Draw string at position (x, y)
u8g2.drawStr(x, y, "Hello World");

// Draw string with UTF-8
u8g2.drawUTF8(x, y, "Unicode: 你好");

// Draw button label
u8g2.drawButton(x, y, w, h, flags, "Button");

// Get text width
uint16_t width = u8g2.getStrWidth("Hello");
```

### Lines and Shapes

```cpp
// Draw line
u8g2.drawLine(x1, y1, x2, y2);

// Draw rectangle
u8g2.drawRect(x, y, w, h);

// Draw filled rectangle
u8g2.fillRect(x, y, w, h);

// Draw circle (x, y, radius)
u8g2.drawCircle(x, y, r);

// Draw filled circle
u8g2.drawDisc(x, y, r);

// Draw ellipse
u8g2.drawEllipse(x, y, rx, ry);

// Draw triangle
u8g2.drawTriangle(x0, y0, x1, y1, x2, y2);

// Draw filled triangle
u8g2.drawFilledTriangle(x0, y0, x1, y1, x2, y2);

// Draw rounded rectangle
u8g2.drawRFrame(x, y, w, h, r);

// Draw filled rounded rectangle
u8g2.drawRBox(x, y, w, h, r);

// Draw XOR line (toggle pixels)
u8g2.drawXOR(x1, y1, x2, y2);
```

### Bitmaps

```cpp
// Draw bitmap from PROGMEM
const uint8_t bitmap[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF,
    // ... more data
};

u8g2.drawBitmap(x, y, w, h, bitmap);

// Draw XBM (X Bitmap format)
const unsigned char icon[] U8X8_PROGMEM = {
    0x00, 0x00, 0x00, 0x00,
    // ... XBM data
};
u8g2.drawXBM(x, y, w, h, icon);
```

### Unicode and Fonts

```cpp
// Enable UTF-8 support
u8g2.enableUTF8Print();

// Use Unicode
u8g2.setFont(u8g2_font_unifont_t_symbols);
u8g2.drawUTF8(0, 15, "Temp: 25°C");

// Chinese characters (requires suitable font)
u8g2.setFont(u8g2_font_wqy12_t_chinese1);
u8g2.drawUTF8(0, 15, "你好世界");
```

## Common Display Constructors

### I2C Displays

| Display | Constructor |
|---------|-------------|
| SSD1306 128x64 | `U8G2_SSD1306_128X64_NONAME_F_HW_I2C` |
| SSD1306 128x32 | `U8G2_SSD1306_128X32_UNIVISION_F_HW_I2C` |
| SH1106 128x64 | `U8G2_SH1106_128X64_NONAME_F_HW_I2C` |
| SH1107 128x128 | `U8G2_SH1107_128X128_F_HW_I2C` |
| SH1107 Seeed 128x128 | `U8G2_SH1107_SEEED_128X128_1_SW_I2C` |

### SPI Displays

| Display | Constructor |
|---------|-------------|
| SSD1306 128x64 | `U8G2_SSD1306_128X64_NONAME_F_4W_HW_SPI` |
| SH1107 128x128 | `U8G2_SH1107_128X128_1_4W_HW_SPI` |
| ST7567 128x64 | `U8G2_ST7567_128X64_F_4W_HW_SPI` |

### Constructor Options

```cpp
// Communication interface suffixes:
_HW_I2C     // Hardware I2C
_SW_I2C     // Software I2C (specify pins)
_4W_HW_SPI  // 4-wire Hardware SPI
_3W_HW_SPI  // 3-wire Hardware SPI

// Buffer mode suffixes:
_F_         // Full buffer (fastest, most RAM)
_2_         // Page buffer, 2x faster than _1_
_1_         // Page buffer, least RAM

// Rotation:
U8G2_R0     // No rotation
U8G2_R1     // 90° rotation
U8G2_R2     // 180° rotation
U8G2_R3     // 270° rotation
```

## Font Selection

U8g2 includes 100+ fonts. Font naming convention: `u8g2_font_<name>_<type>_<size>`

### Common Fonts

```cpp
// Tiny fonts (4-6px height)
u8g2_font_tom_thumb_4x6_tr
u8g2_font_5x7_tr
u8g2_font_5x8_tr

// Small fonts (7-8px height)
u8g2_font_ncenB08_tr
u8g2_font_profont10_mr
u8g2_font_tiny10_tf

// Medium fonts (10-12px height)
u8g2_font_10x20_tr
u8g2_font_12x20_tr
u8g2_font_luBIS08_tf

// Large fonts (14-20px height)
u8g2_font_fur20_tr
u8g2_font_inr24_mr

// Unicode/UTF-8 fonts
u8g2_font_unifont_t_symbols
u8g2_font_wqy12_t_chinese1  // Chinese

// Font type suffixes:
_t   // Transparent (recommended)
_tr  // Transparent, monospaced digits
_tf  // Transparent, full pixel
_mr  // Monospaced, monospaced digits
_mf  // Monospaced, full pixel
```

## Complete Example: Menu System

```cpp
#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

U8G2_SSD1306_128X64_NONAME_F_SW_I2C u8g2(U8G2_R0, SCL, SDA);

const char* menuItems[] = {"Option 1", "Option 2", "Option 3", "Option 4"};
int selectedItem = 0;
int numItems = 4;

void drawMenu() {
    u8g2.clearBuffer();

    // Title bar
    u8g2.setFont(u8g2_font_ncenB08_tr);
    u8g2.drawStr(0, 10, "Main Menu");

    // Draw line under title
    u8g2.drawLine(0, 12, 128, 12);

    // Menu items
    u8g2.setFont(u8g2_font_5x7_tr);
    for (int i = 0; i < numItems; i++) {
        int y = 25 + (i * 10);
        if (i == selectedItem) {
            // Draw selection indicator
            u8g2.drawStr(0, y, ">");
            u8g2.drawBox(0, y - 7, 128, 9);
        }
        u8g2.drawStr(10, y, menuItems[i]);
    }

    u8g2.sendBuffer();
}

void setup() {
    u8g2.begin();
    u8g2.setContrast(128);
}

void loop() {
    drawMenu();
    // Add button input logic here
    delay(100);
}
```

## Complete Example: Sensor Display

```cpp
#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

U8G2_SH1107_SEEED_128X128_1_SW_I2C u8g2(U8G2_R0, 5, 4, U8X8_PIN_NONE);

void displaySensorData(float temp, float humidity, int pressure) {
    u8g2.firstPage();
    do {
        // Title
        u8g2.setFont(u8g2_font_luBIS08_tf);
        u8g2.drawStr(0, 15, "Sensor Data");

        // Temperature
        u8g2.setFont(u8g2_font_ncenB08_tr);
        u8g2.drawStr(0, 35, "Temp:");
        u8g2.setCursor(45, 35);
        u8g2.print(temp);
        u8g2.drawUTF8(85, 35, "°C");

        // Humidity
        u8g2.drawStr(0, 55, "Hum:");
        u8g2.setCursor(45, 55);
        u8g2.print(humidity);
        u8g2.drawStr(85, 55, "%");

        // Pressure
        u8g2.drawStr(0, 75, "Press:");
        u8g2.setCursor(45, 75);
        u8g2.print(pressure);
        u8g2.drawStr(85, 75, "hPa");

    } while (u8g2.nextPage());
}

void setup() {
    u8g2.begin();
}

void loop() {
    // Simulated sensor data
    float temp = 25.5;
    float humidity = 60.2;
    int pressure = 1013;

    displaySensorData(temp, humidity, pressure);
    delay(1000);
}
```

## Complete Example: Progress Bar

```cpp
#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

U8G2_SSD1306_128X64_NONAME_F_SW_I2C u8g2(U8G2_R0, SCL, SDA);

void drawProgressBar(int x, int y, int w, int h, int progress) {
    // Draw frame
    u8g2.drawFrame(x, y, w, h);

    // Draw filled portion
    int fillWidth = (w * progress) / 100;
    u8g2.drawBox(x + 1, y + 1, fillWidth - 2, h - 2);

    // Draw percentage text
    u8g2.setFont(u8g2_font_ncenB08_tr);
    u8g2.setCursor(x + w / 2 - 10, y - 3);
    u8g2.print(progress);
    u8g2.print("%");
}

void setup() {
    u8g2.begin();
}

void loop() {
    for (int i = 0; i <= 100; i += 5) {
        u8g2.clearBuffer();
        drawProgressBar(10, 30, 108, 12, i);
        u8g2.sendBuffer();
        delay(100);
    }
    delay(1000);
}
```

## Troubleshooting

### Display stays blank

1. **Check I2C address**: Use I2C scanner to verify display address
2. **Verify wiring**: Ensure SDA/SCL are connected correctly
3. **Wrong constructor**: Make sure the display controller matches your hardware
4. **Power issue**: Some displays need 5V, not 3.3V

### Flickering display

1. **Reduce update frequency** in `loop()`
2. **Use full buffer mode** (`_F_` suffix) instead of page buffer
3. **Add delay** between `sendBuffer()` calls

### Wrong display orientation

Change rotation in constructor:
```cpp
U8G2_R0  // 0°
U8G2_R1  // 90°
U8G2_R2  // 180°
U8G2_R3  // 270°
```

### Not enough memory

1. **Use page buffer mode** (`_1_` or `_2_` suffix)
2. **Choose smaller font**
3. **Reduce bitmap sizes**
4. **Use software I2C** to save a few bytes

### Display shows garbage

1. **Wrong I2C address**: Common addresses are `0x3C` or `0x3D`
2. **Wrong pin numbers** for software I2C
3. **Incompatible display driver**: Verify your display controller

## Supported Displays on XIAO

| Display | Controller | Interface | Recommended Constructor |
|---------|-----------|-----------|------------------------|
| Grove OLED 0.96" | SSD1315 | I2C | `U8G2_SSD1306_128X64_NONAME_F_SW_I2C` |
| Grove OLED 1.12" | SH1107 | I2C/SPI | `U8G2_SH1107_SEEED_128X128_1_SW_I2C` |
| Grove OLED Y+B 0.96" | SSD1315 | I2C | `U8G2_SSD1306_128X64_NONAME_F_SW_I2C` |

## References

- [U8g2 GitHub Repository](https://github.com/olikraus/U8g2_Arduino)
- [U8g2 Wiki](https://github.com/olikraus/U8g2_Arduino/wiki)
- [Font List](https://github.com/olikraus/U8g2_Arduino/wiki/fntlistall)
