# Adafruit SSD1306 Library for XIAO

## Overview

SSD1306 is a popular monochrome OLED controller. Common in 128x64 and 128x32 displays.

## Board Compatibility

All XIAO boards with I2C:
- ESP32C3/C5/C6/S3: I2C on D4/D5
- nRF52840/MG24: I2C on D4/D5
- RP2040/RP2350: I2C on D4/D5
- SAMD21/RA4M1: I2C on D4/D5

## Pin Connection (I2C)

```cpp
SSD1306       XIAO Board
-------       -----------
VCC    →      3.3V
GND    →      GND
SCL    →      D5 (I2C SCL)
SDA    →      D4 (I2C SDA)

Common I2C addresses:
- 0x3C (most common)
- 0x3D (some displays)
```

## Basic Setup

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_ADDR 0x3C

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);

void setup() {
    Serial.begin(115200);

    // Initialize display
    if (!display.begin(SSD1306_SWITCHCAPVCC, OLED_ADDR)) {
        Serial.println("SSD1306 allocation failed");
        while(1);
    }

    // Clear display buffer
    display.clearDisplay();

    // Draw test pattern
    display.setTextSize(1);
    display.setTextColor(SSD1306_WHITE);
    display.setCursor(0, 0);
    display.println("Hello XIAO!");

    // Push buffer to display
    display.display();
}

void loop() {}
```

## Display Resolutions

```cpp
// Common SSD1306 resolutions
Adafruit_SSD1306 display128x64(128, 64, &Wire, -1);  // Most common
Adafruit_SSD1306 display128x32(128, 32, &Wire, -1);  // Wide
Adafruit_SSD1306 display96x16(96, 16, &Wire, -1);    // Narrow

void setup() {
    // Use appropriate initialization for your display
    display128x64.begin(SSD1306_SWITCHCAPVCC, 0x3C);
}
```

## Text Display

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);

void setup() {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
    display.clearDisplay();

    // Text size (1x, 2x, 3x, 4x)
    display.setTextSize(1);
    display.setCursor(0, 0);
    display.println("Size 1");

    display.setTextSize(2);
    display.setCursor(0, 16);
    display.println("Size 2");

    // Text color
    display.setTextSize(1);
    display.setTextColor(SSD1306_WHITE);
    display.setCursor(0, 40);
    display.println("White text");

    display.setTextColor(SSD1306_BLACK, SSD1306_WHITE);  // Inverted
    display.println("Inverted");

    display.display();
}

void loop() {}
```

## Sensor Dashboard

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <Adafruit_BME280.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);
Adafruit_BME280 bme;

void updateDashboard() {
    display.clearDisplay();

    // Title
    display.setTextSize(1);
    display.setTextColor(SSD1306_WHITE);
    display.setCursor(0, 0);
    display.println("Sensor Dashboard");
    display.drawLine(0, 12, 127, 12, SSD1306_WHITE);

    // Temperature
    display.setCursor(0, 20);
    display.printf("Temp: %.1f C", bme.readTemperature());

    // Humidity
    display.setCursor(0, 32);
    display.printf("Humidity: %.1f%%", bme.readHumidity());

    // Pressure
    display.setCursor(0, 44);
    display.printf("Pressure: %.0f hPa", bme.readPressure() / 100);

    // Altitude
    display.setCursor(0, 56);
    display.printf("Alt: %.1f m", bme.readAltitude(1013.25));

    display.display();
}

void setup() {
    Wire.begin();
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
    bme.begin(0x76);
}

void loop() {
    updateDashboard();
    delay(2000);
}
```

## Animation

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);

int x = 0;
int y = 32;
int dx = 2;
int dy = 1;

void animate() {
    display.clearDisplay();

    // Bounce ball
    x += dx;
    y += dy;

    if (x <= 0 || x >= 124) dx = -dx;
    if (y <= 0 || y >= 60) dy = -dy;

    display.fillCircle(x, y, 4, SSD1306_WHITE);

    display.display();
    delay(30);
}

void setup() {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
}

void loop() {
    animate();
}
```

## Progress Bar

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);

void drawProgressBar(int y, int percent) {
    // Frame
    display.drawRect(10, y, 108, 12, SSD1306_WHITE);

    // Fill
    int fillWidth = (106 * percent) / 100;
    display.fillRect(11, y + 1, fillWidth, 10, SSD1306_WHITE);

    // Percentage
    display.setTextSize(1);
    display.setCursor(54, y + 2);
    display.printf("%d%%", percent);
}

void setup() {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);

    for (int i = 0; i <= 100; i += 5) {
        display.clearDisplay();
        display.setCursor(30, 10);
        display.println("Loading...");

        drawProgressBar(30, i);
        display.display();
        delay(100);
    }
}

void loop() {}
```

## Scrollable Menu

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);

const char* menuItems[] = {
    "Option 1",
    "Option 2",
    "Option 3",
    "Option 4",
    "Option 5"
};
int itemCount = 5;
int selectedIndex = 0;
int topItem = 0;

void drawMenu() {
    display.clearDisplay();

    for (int i = 0; i < 4 && (topItem + i) < itemCount; i++) {
        int yPos = i * 16;

        if (topItem + i == selectedIndex) {
            // Highlight selected item
            display.fillRect(0, yPos, 127, 14, SSD1306_WHITE);
            display.setTextColor(SSD1306_BLACK);
        } else {
            display.setTextColor(SSD1306_WHITE);
        }

        display.setCursor(4, yPos + 4);
        display.println(menuItems[topItem + i]);
    }

    // Scroll indicators
    if (topItem > 0) {
        display.fillTriangle(64, 0, 60, 4, 68, 4, SSD1306_WHITE);
    }
    if (topItem + 4 < itemCount) {
        display.fillTriangle(64, 63, 60, 59, 68, 59, SSD1306_WHITE);
    }

    display.display();
}

void setup() {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
}

void loop() {
    // Simulate button input
    static unsigned long lastUpdate = 0;
    if (millis() - lastUpdate > 1000) {
        lastUpdate = millis();
        selectedIndex = (selectedIndex + 1) % itemCount;

        if (selectedIndex >= topItem + 4) {
            topItem = selectedIndex - 3;
        }
        if (selectedIndex < topItem) {
            topItem = selectedIndex;
        }

        drawMenu();
    }
}
```

## Bitmap Icons

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);

// 16x16 WiFi icon
const uint8_t wifiIcon[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x07, 0xE0, 0x18, 0x18,
    0x20, 0x04, 0x40, 0x02, 0x80, 0x01, 0x80, 0x01,
    0x80, 0x01, 0x40, 0x02, 0x20, 0x04, 0x18, 0x18,
    0x07, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

void setup() {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
    display.clearDisplay();

    // Draw icon
    display.drawBitmap(0, 0, wifiIcon, 16, 16, SSD1306_WHITE);

    // Text next to icon
    display.setCursor(24, 4);
    display.println("WiFi: Connected");

    display.display();
}

void loop() {}
```

## Custom Characters

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);

// Draw degree symbol
void drawDegreeSymbol(int x, int y) {
    display.drawCircle(x, y, 2, SSD1306_WHITE);
    display.drawPixel(x, y - 1, SSD1306_BLACK);
}

void setup() {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
    display.clearDisplay();

    display.setTextSize(1);
    display.setCursor(0, 0);

    display.print("Temperature: 23");
    drawDegreeSymbol(display.getCursorX(), display.getCursorY() - 6);
    display.println("C");

    display.display();
}

void loop() {}
```

## Power Management

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);

void setup() {
    display.begin(SSD1306_SWITCHCAPVCC, 0x3C);

    // Dim display
    display.dim(true);  // true = dim, false = normal

    // Or turn off completely
    // display.ssd1306_command(SSD1306_DISPLAYOFF);
}

void loop() {}
```

## Best Practices

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

void setup() {
    // Best practice 1: Check initialization
    if (!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
        Serial.println("Failed");
        while(1);
    }

    // Best practice 2: Clear before first use
    display.clearDisplay();
    display.display();

    // Best practice 3: Batch updates
    // Don't call display() after every draw
    display.drawRect(0, 0, 50, 50, WHITE);
    display.fillRect(60, 0, 50, 50, WHITE);
    display.display();  // Once at the end

    // Best practice 4: Use PROGMEM for bitmaps
    const uint8_t bitmap[] PROGMEM = { /* data */ };

    // Best practice 5: Minimize full refreshes
    // Only clear what needs updating
    display.fillRect(0, 0, 20, 20, BLACK);  // Clear specific area
    display.setCursor(0, 0);
    display.println("New data");
    display.display();
}

void loop() {}
```

## References

- [Adafruit SSD1306 Library](https://github.com/adafruit/Adafruit_SSD1306)
- [SSD1306 Datasheet](https://cdn-shop.adafruit.com/datasheets/SSD1306.pdf)
