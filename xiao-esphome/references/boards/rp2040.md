# XIAO RP2040 ESPHome Configuration

## Base Configuration

Complete ESPHome configuration for XIAO RP2040.

```yaml
# XIAO RP2040 Base Configuration
substitutions:
  device_name: "xiao-rp2040"
  friendly_name: "XIAO RP2040"
  device_description: "SeeedStudio XIAO RP2040"

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}
  comment: ${device_description}
  platform: RP2040
  board: rpipicow
  project:
    name: "SeeedStudio.XIAO_RP2040"
    version: "1.0.0"

# Enable logging
logger:
  level: INFO
  baud_rate: 0

# Enable Home Assistant API (via WiFi or USB)
api:
  encryption:
    key: !secret api_encryption_key
  password: !secret api_password

# Enable OTA updates
ota:
  - platform: esphome
    password: !secret ota_password

# WiFi (requires external WiFi module or use with USB)
# Comment out if using USB CDC
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  fast_connect: true
  power_save_mode: high

  ap:
    ssid: "${device_name} Fallback"
    password: !secret ap_password

captive_portal:
web_server:
  port: 80

mdns:

# Status LED (built-in green LED)
status_led:
  pin:
    number: GPIO25
    inverted: true

# I2C Bus (D6=SDA, D7=SCL)
i2c:
  sda: GPIO6
  scl: GPIO7
  scan: true
  frequency: 100kHz

# SPI Bus (D8=SCK, D9=MISO, D10=MOSI)
spi:
  clk_pin: GPIO2
  miso_pin: GPIO4
  mosi_pin: GPIO3

# UART (D0=TX, D1=RX)
uart:
  tx_pin: GPIO0
  rx_pin: GPIO1
  baud_rate: 9600

# Button (D7)
binary_sensor:
  - platform: gpio
    name: "Button"
    pin:
      number: GPIO7
      inverted: true
      mode:
        input: true
        pullup: true

# Internal sensors
sensor:
  - platform: uptime
    name: "Uptime"

  - platform: template
    name: "CPU Temperature"
    lambda: |-
      return temperature_read();
    unit_of_measurement: "°C"
    update_interval: 60s

text_sensor:
  - platform: version
    name: "ESPHome Version"

switch:
  - platform: restart
    name: "Restart"
```

## Pin Mapping Reference

| XIAO Pin | GPIO | ESPHome Pin | Function |
|----------|------|-------------|----------|
| D0 | GPIO0 | GPIO0 | UART TX |
| D1 | GPIO1 | GPIO1 | UART RX |
| D2 | GPIO2 | GPIO2 | SPI SCK |
| D3 | GPIO3 | GPIO3 | SPI MOSI |
| D4 | GPIO4 | GPIO4 | SPI MISO |
| D5 | GPIO5 | GPIO5 | PWM |
| D6 | GPIO6 | GPIO6 | I2C SDA |
| D7 | GPIO7 | GPIO7 | I2C SCL |
| D8 | GPIO8 | GPIO8 | PWM |
| D9 | GPIO9 | GPIO9 | PWM |
| D10 | GPIO10 | GPIO10 | PWM |
| D16 | GPIO16 | GPIO16 | UART1 TX |
| D17 | GPIO17 | GPIO17 | UART1 RX |
| D18 | GPIO18 | GPIO18 | PWM |
| D19 | GPIO19 | GPIO19 | PWM |
| D20 | GPIO20 | GPIO20 | PWM |
| D21 | GPIO21 | GPIO21 | PWM |

Built-in LED: GPIO25 (green)

## Board Specifications

| Feature | Value |
|---------|-------|
| MCU | RP2040 |
| Core | ARM Cortex-M0+ dual-core @ 133MHz |
| Flash | 2 MB (external QSPI) |
| RAM | 264 KB |
| GPIO | 30 pins |
| ADC | 12-bit, 4 channels |
| PWM | 16 channels |
| PIO | 2 x PIO blocks |
| USB | USB 1.1 device |

## RP2040 Specific Features

### PIO (Programmable I/O)

```yaml
# Use PIO for custom protocols
# Note: Requires custom ESPHome component or external script
remote_transmitter:
  - platform: rc_switch
    pin: GPIO2
    carrier_frequency: 433kHz
```

### Deep Sleep

```yaml
# RP2040 deep sleep (restart on wake)
deep_sleep:
  run_duration: 30s
  sleep_duration: 300s
```

## WiFi Configuration

### Option 1: External WiFi Module

```yaml
# Use ESP8266/ESP32 AT module
uart:
  tx_pin: GPIO0
  rx_pin: GPIO1
  baud_rate: 115200

# Configure UART WiFi
wifi:
  # Requires custom component for AT WiFi
```

### Option 2: USB CDC (No WiFi)

```yaml
# Use USB for API communication
# Remove WiFi section

# Enable USB CDC
api:
  on_connected:
    then:
      - logger.log: "Connected via USB"
```

## Common Components

### BME280 Sensor

```yaml
sensor:
  - platform: bme280
    i2c_id: bus_i2c
    address: 0x76
    temperature:
      name: "Temperature"
    pressure:
      name: "Pressure"
    humidity:
      name: "Humidity"
    update_interval: 60s
```

### SSD1306 Display

```yaml
display:
  - platform: ssd1306_i2c
    model: "SSD1306 128x64"
    i2c_id: bus_i2c
    address: 0x3C
    lambda: |-
      it.printf(0, 0, id(font), "XIAO RP2040");
```

### NeoPixel LED

```yaml
light:
  - platform: neopixelbus
    name: "NeoPixel"
    pin: GPIO2
    num_leds: 1
    type: GRB
```

## Complete Example: Weather Station (USB)

```yaml
substitutions:
  device_name: "xiao-rp2040-weather"

esphome:
  name: ${device_name}
  platform: RP2040
  board: rpipicow

# No WiFi - use USB API
api:
  password: !secret api_password

ota:
logger:
  baud_rate: 0

i2c:
  sda: GPIO6
  scl: GPIO7

sensor:
  - platform: bme280
    temperature:
      name: "Temperature"
    pressure:
      name: "Pressure"
    humidity:
      name: "Humidity"
    address: 0x76
    update_interval: 60s

display:
  - platform: ssd1306_i2c
    model: "SSD1306 128x64"
    address: 0x3C
    lambda: |-
      it.printf(0, 0, id(font), "T: %.1f°C", id(bme280_temperature).state);
      it.printf(0, 16, id(font), "P: %.0fhPa", id(bme280_pressure).state);
      it.printf(0, 32, id(font), "H: %.1f%%", id(bme280_humidity).state);
```

## Complete Example: With External WiFi

```yaml
substitutions:
  device_name: "xiao-rp2040-wifi"

esphome:
  name: ${device_name}
  platform: RP2040
  board: rpipicow

# Requires external ESP8266/ESP32 AT WiFi module
# Or use WIZnet W5500 for Ethernet

# For this example, assume USB API only
api:
  password: !secret api_password

ota:
logger:
```

## Dual Core Usage

```yaml
# RP2040 has two cores
# Use second core for heavy tasks

interval:
  - interval: 1s
    then:
      - lambda: |-
          // Run on core 1
          multicore_launch_core1([]() {
            // Heavy computation here
          });
```

## PWM Output

```yaml
output:
  - platform: ledc
    pin: GPIO5
    frequency: 1000 Hz
    id: pwm_output

light:
  - platform: monochromatic
    output: pwm_output
    name: "PWM Light"
```

## Troubleshooting

### Boot Issues

1. Hold BOOTSEL while connecting USB
2. Look for RPI-RP2 drive
3. Copy .uf2 file

### USB CDC Not Working

```yaml
# Disable hardware UART
logger:
  baud_rate: 0  # Use USB CDC

# Enable USB CDC
esphome:
  platformio_options:
    build_flags: "-DUSE_USBCDC"
```

### I2C Issues

1. Check pull-up resistors
2. Verify pin numbers
3. Enable I2C scan

## Migration from Raspberry Pi Pico

1. Update `platform: RP2040`
2. Update `board: rpipicow`
3. Change pin numbers to XIAO pinout
4. Update I2C pins (GPIO6/7 vs Pico GPIO4/5)

## Performance Tips

1. **Use both cores** for parallel tasks
2. **PIO** for custom protocols
3. **USB CDC** for low-latency communication
4. **PWM** for smooth LED fading
5. **Deep sleep** for battery projects

## Key Differences from ESP32 Boards

| Feature | RP2040 | ESP32 |
|---------|--------|-------|
| WiFi | No (external only) | Built-in |
| BLE | No | Built-in |
| USB | Device only | Device/Host |
| PIO | Yes (programmable) | No |
| Power | Very low | Higher |
| Boot mode | UF2 file | Serial upload |
| Price | Lower | Higher |

## When to Use RP2040

**Good for:**
- USB devices (HID, MIDI)
- Low power sensor nodes
- Custom protocols (PIO)
- Display projects
- Battery powered devices

**Not ideal for:**
- WiFi projects (use ESP32)
- BLE projects (use ESP32/nRF)
- Network communication
